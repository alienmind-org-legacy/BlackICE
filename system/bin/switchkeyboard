#!/system/bin/sh
if [ "$1" = "nexussswype" ]; then
  FILE=nexussswype.tgz
  MD5SUM=cf933c0e76022bfc16d9e00df9a0c3d0
  URL="http://www.losinj.com/blackice/nexussswype.tgz"
elif [ "$1" = "htcime" ]; then
  FILE=htcime.tgz
  MD5SUM=4f46cc059c890db70b324816e8722775
  URL="http://www.losinj.com/blackice/htcime.tgz"
fi
if [ ! -d /sdcard/blackice ]; then
  MK=1
  mkdir -p /sdcard/blackice
fi
cd /sdcard/blackice
if [ -f "$FILE" ]; then
  MD5=`md5sum $FILE | awk '{ print $1 }'`
  if [ "$MD5" = "$MD5SUM" ]; then
     GOOD=1
  fi
fi
if [ "$GOOD" != "1" ]; then
  rm -f "$FILE"
  wget "$URL"
  MD5=`md5sum $FILE | awk '{ print $1 }'`
  if [ "$MD5" = "$MD5SUM" ]; then
     GOOD=1
  fi
fi
if [ "$GOOD" = "1" ]; then
  mount -o remount,rw /system
  cd /
  tar -xzvf "/sdcard/blackice/$FILE"
  chmod 644 /system/lib/lib*.so
  chmod 644 /system/app/*.apk
  mount -o remount,ro /system
  cd - >/dev/null 2>&1
  echo "Done! Please choose new Input Method"
else
  echo "Failed to download / uncompress input method package"
  exit 1
fi
# rm -f /sdcard/blackice/$FILE

